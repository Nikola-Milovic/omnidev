# Changesets

This folder is automatically generated by `@changesets/cli` to manage versioning and publishing.

## Adding a changeset

When you make a change that should be released:

```bash
bunx changeset
```

This will prompt you to:
1. Select which packages are affected
2. Choose a bump type (patch/minor/major)
3. Write a summary for the changelog

The changeset file will be committed with your changes.

## Releasing

Releases are automated via GitHub Actions using **trusted publishing** (OIDC).

When changesets are merged to `main`:
1. A "Release" PR is automatically created/updated with version bumps
2. Merging the Release PR publishes to npm (no tokens needed)

## First-time Setup (Bootstrap)

Since trusted publishers require packages to exist on npm first, the initial publish needs special handling:

### Option A: Manual First Publish (Recommended)
```bash
# 1. Login to npm
npm login

# 2. Publish packages manually
cd packages/core && npm publish --access public
cd ../cli && npm publish --access public

# 3. Configure trusted publishers on npmjs.com (see below)
```

### Option B: Use a Token for First Publish Only
1. Create an automation token at npmjs.com
2. Add it as `NPM_TOKEN` secret in GitHub
3. Temporarily add `NPM_TOKEN: ${{ secrets.NPM_TOKEN }}` to release.yml
4. After first publish, configure trusted publishers and remove the token

### Configuring Trusted Publishers

After packages exist on npm, for each package:

1. Go to https://www.npmjs.com/package/@omnidev-ai/core/access (replace with each package)
2. Find "Trusted Publisher" section
3. Configure:
   - **Organization/user**: `Nikola-Milovic`
   - **Repository**: `omnidev`
   - **Workflow filename**: `release.yml`
   - **Environment**: (leave empty)

Repeat for `@omnidev-ai/cli`.

## Security

Trusted publishing eliminates the need for long-lived npm tokens:
- Uses short-lived OIDC tokens generated per-workflow
- Automatically generates provenance attestations
- Cannot be extracted or reused outside the workflow

See: https://docs.npmjs.com/trusted-publishers
